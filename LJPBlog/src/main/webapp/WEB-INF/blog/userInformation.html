<!doctype html>
<html class="no-js">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>LJPBlog博客 - ${user.userAnotherName}的个人信息</title>
		<meta name="description" content="这是一个form页面">
		<meta name="keywords" content="form">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<meta name="apple-mobile-web-app-title" content="Amaze UI" />
		<link rel="apple-touch-icon-precomposed" href="${_path}/static/assets/i/app-icon72x72@2x.png">
		<link rel="alternate icon" type="image/png" href="${_path}/static/assets/i/favicon.png">
		<link rel="stylesheet" href="${_path}/static/assets/css/amazeui.min.css" />
		<link rel="stylesheet" href="${_path}/static/layui-v2.4.5/layui/css/layui.css">
		<link rel="stylesheet" href="${_path}/static/assets/css/amazeui.min.css">
		<link rel="stylesheet" href="${_path}/static/assets/css/app.css">
		<link rel="stylesheet" href="${_path}/static/bootstrap/css/bootstrap.min.css" />
		<script src="${_path}/static/bootstrap/js/bootstrap.min.js"></script>
	</head>
	<body>
		<!--:include("../header.html"){}  -->

		<div class="am-cf admin-main">

			<!-- 内容开始 -->
			<div class="admin-content">
				<div class="admin-content-body">

					<div class="am-u-sm-12 am-u-md-4 am-u-md-push-8">
						<div class="am-panel am-panel-default">
							<div class="am-panel-bd">
								<div class="am-g">
									<!-- 用户的头像开始 -->
									<div class="am-u-md-4">
										<!--: if(user.userHeadSculpture == null || user.userHeadSculpture == ""){  -->
										<img class="am-img-circle am-img-thumbnail" src="http://s.amazeui.org/media/i/demos/bw-2014-06-19.jpg?imageView/1/w/200/h/200/q/80"
										 alt="" />
										<!--: }else{  -->
										<img class="am-img-circle am-img-thumbnail" src="${user.userHeadSculpture}" alt="" />
										<!--: }  -->
									</div>
									<!-- 用户的头像结束 -->
									<div class="am-u-md-8">
										<!-- 上传头像的表格开始 -->
										<form class="am-form" id="picForm" enctype="multipart/form-data">
											<div class="am-form-group">
												<input type="file" id="userPic" name="files">
												<p class="am-form-help">请选择要上传的文件...</p>
												<button id="upload" type="button" class="am-btn am-btn-primary am-btn-xs">保存</button>
											</div>
										</form>
										<!-- 上传头像的表格结束 -->
									</div>
								</div>
							</div>
						</div>

						<!-- 用户的等级信息开始 -->
						<div class="am-panel am-panel-default">
							<div class="am-panel-bd">
								<div class="user-info">
									<p>等级信息</p>
									<div class="am-progress am-progress-sm">
										<div class="am-progress-bar" style="width: ${user.userExperience % 100}%"></div>
									</div>
									<p class="user-info-order">当前等级：<strong>LV${user.userLevel}</strong> 距离下一级别：<strong>${user.userLevel >= 99 ? 0
											: 100 - user.userExperience % 100}</strong></p>
								</div>
							</div>
						</div>
						<!-- 用户的等级信息结束 -->

					</div>

					<div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
						<div class="am-tabs am-margin" data-am-tabs>

							<div class="am-tab-panel am-fade am-in am-active">
								<form id="form" class="am-form am-form-horizontal" action="javascript:;">
									<!-- 用户的隐藏信息开始 -->
									<input id="userId" type="hidden" value="${user.userId}" id="userId" name="userId">
									<input id="headSculpture" type="hidden" value="${user.userHeadSculpture}" name="userHeadSculpture">
									<!-- 用户的隐藏信息结束 -->

									<!-- 用户的别名开始 -->
									<div class="am-form-group">
										<label for="userAnotherName" class="am-u-sm-3 am-form-label">别名 / Name</label>
										<div class="am-u-sm-9">
											<input type="text" name="userAnotherName" id="userAnotherName" value="${user.userAnotherName}" placeholder="姓名 / Name">
											<small>输入你的名字，让我们记住你。</small>
										</div>
									</div>
									<!-- 用户的别名结束 -->

									<br>

									<!-- 用户的邮箱开始 -->
									<div class="am-form-group">
										<label for="userEmail" class="am-u-sm-3 am-form-label">电子邮件 / Email</label>
										<div class="am-u-sm-9">
											<input type="email" name="userEmail" id="userEmail" value="${user.userEmail}" placeholder="输入你的电子邮件 / Email">
											<small>邮箱你懂得...</small>
										</div>
									</div>
									<!-- 用户的邮箱结束 -->

									<!-- 用户的电话开始 -->
									<div class="am-form-group">
										<label for="userPhone" class="am-u-sm-3 am-form-label">电话 / Telephone</label>
										<div class="am-u-sm-9">
											<input type="tel" name="userPhone" id="userPhone" value="${user.userPhone}" placeholder="输入你的电话号码 / Telephone">
										</div>
									</div>
									<!-- 用户的电话结束 -->

									<br>

									<!-- 用户的简介开始 -->
									<div class="am-form-group">
										<label for="userAbstract" class="am-u-sm-3 am-form-label">简介 / Intro</label>
										<div class="am-u-sm-9">
											<textarea class="" rows="5" name="userAbstract" id="userAbstract" placeholder="输入个人简介">${user.userAbstract}</textarea>
											<small>250字以内写出你的一生...</small>
										</div>
									</div>
									<!-- 用户的简介结束 -->

									<br>

									<div class="am-form-group">
										<div class="am-u-sm-9 am-u-sm-push-3">
											<button type="button" id="save" class="am-btn am-btn-primary">保存修改</button>
										</div>
									</div>
								</form>
								<!-- 表单结束 -->
							</div>
						</div>
					</div>


				</div>
				<!-- 内容结束 -->

			</div>
		</div>
		<!-- 脚注 -->
		<!--:include("../footer.html"){}  -->

	</body>
	<script src="${_path}/static/JQuery/jquery.min.js"></script>
	<script src="${_path}/static/assets/js/amazeui.min.js"></script>
	<script src="${_path}/static/assets/js/app.js"></script>
	<script src="${_path}/static/layui-v2.4.5/layui/layui.all.js"></script>
	<script src="${_path}/static/JQuery/ajaxfileupload.js"></script>
	<script>
		/* 头像上传事件 */
		$('#upload').click(function() {
			var id = $('#userId').val();
			$.ajaxFileUpload({
				url: '${_path}/image/upload',
				secureuri: false,
				fileElementId: 'userPic',
				dataType: 'jsonp',
				success: function(data,status) {
					if(data == 1){
						layermsg("文件类型不正确!");
					}else if(data == 2){
						layermsg("非图片文件!");
					}else if(data == 3){
						layermsg("没有需要上传的文件!");
					}else {
						$('#headSculpture').val(data);
						$('#save').click();
					}

				}
			})
		})

		$('#info').addClass("am-active");
		$('#main').removeClass("am-active");
		$('#report').removeClass('am-active');

		/* 保存信息修改事件 */
		$("#save").click(function() {
			var emailReg =  new RegExp('^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$');
			var telReg = new RegExp('^\[0-9]{9,12}$');
			var emil = $('#userEmail').val();
			var tel = $('#userPhone').val();
			if (!telReg.test(tel)) {
				layermsg("请输入正确的电话号码");
			} else if(!emailReg.test(emil)){
				layermsg("请输入正确的邮箱");
			} else {
				$.ajax({
					url: '${_path}/user/update',
					type: 'post',
					data: JSON.stringify($('#form').serializeObject()),
					contentType: "application/json",
					success: function(data) {
						if (data == "1") {
							layermsg("保存成功");
							window.location.reload();
						}
					}
				})
			}
		})

		/* form表单内容转换为json对象的方法 */
		$.fn.serializeObject = function() {
			var o = {};
			var a = this.serializeArray();
			$.each(a, function() {
				if (o[this.name]) {
					if (!o[this.name].push) {
						o[this.name] = [o[this.name]];
					}
					o[this.name].push(this.value || '');
				} else {
					o[this.name] = this.value || '';
				}
			});
			return o;
		};

		function layermsg(msg) {
			layui.use(['layer'], function() {
				var layer = layui.layer;
				layer.msg(msg);
			})
		}
	</script>
</html>
